國立臺北科技大學

2023 Spring 資工系物件導向程式實習

期末報告

海戰棋

![](media/image1.jpeg){width="5.768055555555556in"
height="3.4069444444444446in"}

第九組：

# 目錄 {#目錄 .TOC-Heading}

[壹、 簡介 [3](#_Toc137324698)](#_Toc137324698)

[一、 動機 [3](#_Toc137443817)](#_Toc137443817)

[二、 分工 [4](#_Toc137324700)](#_Toc137324700)

[貳、 遊戲介紹 [5](#_Toc137324701)](#_Toc137324701)

[一、 遊戲說明 [5](#_Toc137324702)](#_Toc137324702)

[二、 遊戲圖形 [7](#_Toc137443823)](#_Toc137443823)

[三、 遊戲音效 [12](#_Toc137443824)](#_Toc137443824)

[四、 三、程式設計 [13](#_Toc137324705)](#_Toc137324705)

[五、 1. 程式架構 [13](#_Toc137324706)](#_Toc137324706)

[六、 2. 程式類別 [13](#_Toc137324707)](#_Toc137324707)

[七、 程式技術 [14](#_Toc137324708)](#_Toc137324708)

[八、 四、結語 [16](#_Toc137324709)](#_Toc137324709)

[九、 [1. 問題及解決方法（待詢問討論）]{.mark}
[16](#_Toc137324710)](#_Toc137324710)

[十、 [2. 時間表（填寫時間）]{.mark}
[16](#_Toc137324711)](#_Toc137324711)

[十一、 3. 貢獻比例 [20](#_Toc137324712)](#_Toc137324712)

[十二、 自我檢核表 [20](#_Toc137324713)](#_Toc137324713)

[十三、 收穫 [20](#_Toc137324714)](#_Toc137324714)

[十四、 心得或感想 [21](#_Toc137324715)](#_Toc137324715)

[十五、 對於本課程的建議、想說的話:如果有的話
[22](#_Toc137324716)](#_Toc137324716)

**\
**

**\
**

1.  []{#_Toc137324698 .anchor}簡介

    1.  　[]{#_Toc137443817 .anchor}動機

> 本專題選擇開發海戰棋遊戲作為物件導向程式設計的主題，旨在探索並應用基礎程式設計與物件導向程式設計，帶給我們的演算邏輯及物件概念和技術。海戰棋遊戲，不單是一款僅頻運氣隨機就能取勝的遊戲，更是一款具有豐富的規則性和策略性的遊戲，玩家需思考佈局、推測對手的船艦位置和分析對手的行動模式等，這將提供思考演算法和設計，不同的遊戲關卡難度，也將會有對應不同的應對規則。遊戲的規則和算法將進一步，促使深入應用與理解物件導向觀念，透過良好的物件導向程式設計架構的建立，將遊戲與算法元素轉化為物件，並利用封裝、繼承和多形等概念來組織創建整體遊戲。

2.  []{#_Toc137324700 .anchor}分工

    1.  張庭瑋

        I.  客製化類別與函式

        II. 通用遊戲架構

            i.  棋盤擺放與隨機配置

            ii. 回合機制

            iii. 音效

            iv. 作弊模式

        III. 單人模式

        IV. 報告

    2.  李子儀

        I.  雙人模式

        II. 棋譜衍伸類別建置

        III. UI

        IV. 報告

```{=html}
<!-- -->
```
2.  []{#_Toc137324701 .anchor}遊戲介紹

    1.  []{#_Toc137324702 .anchor}遊戲說明

> 開啟遊戲時會進入遊戲首頁（圖 1），在此頁面點擊左鍵即可進入主選單。
>
> 主選單（）提供玩家兩種模式可供選擇，分別是單人模式和雙人模式。單人模式共有四種難度（圖
> 3）：簡單、普通、困難與極限。在選擇完難度後進入擺放階段。
>
> 在擺放階段（圖
> 4、）中，玩家可以根據個人策略進行手動擺放船艦，也可以選擇自動擺放功能，由系統自動為其擺放船艦。不論是手動還是自動擺放，玩家在擺放完成後仍有機會進行微調修改，以確保自己的船艦佈局最為理想。
>
> 另一方面，如果玩家選擇雙人模式，則玩家一和玩家二將輪流進行擺放階段（、圖
> 5、圖 6）。
>
> 當雙方完成擺放後，遊戲進入回合進行階段（、圖
> 8）。在每輪遊戲中，玩家一將先行，從棋盤上選擇一格進行猜測。玩家可以選擇不同的位置進行猜測，以找出敵方的戰艦位置。
>
> 若玩家一猜中了敵方的戰艦，他將繼續進行猜測，直到未猜中為止。然後，輪到電腦控制的敵方（如果是單人模式）或玩家二進行猜測，依此類推。
>
> 在每個回合結束後，回合進行權將再次回到玩家一手中，並依此輪流進行，直到其中一方擊沉了對方的所有船艦（圖
> 9），此時進入遊戲的結束階段。
>
> 在結束階段（圖 10）中有兩個按鈕。分別提供回到主選單與離開遊戲的功能。
>
> 此外，遊戲配有作弊模式（圖
> 10）。使用作弊碼「上上下下左右左右ＢＡ」以開啟作弊模式。當作弊模式啟用時會切換背景音樂，在回合階段中顯示雙方所有船隻。

2.  []{#_Toc137443823 .anchor}遊戲圖形

表 1 遊戲圖形與對應介紹表

+-----------------------------------------------------------------------+
| ![](media/image1.jpeg){width="3.8027318460192476in" height="2.25in"}  |
+=======================================================================+
| 圖 1遊戲首頁頁面                                                      |
+-----------------------------------------------------------------------+
| ![](media/image2.jpeg){width="3.8027318460192476in" height="2.25in"}  |
+-----------------------------------------------------------------------+
| 圖 2遊戲主選單                                                        |
+-----------------------------------------------------------------------+
| ![](media/image3.jpeg){width="3.821963035870516in" height="2.25in"}   |
+-----------------------------------------------------------------------+
| 圖 3單人模式困難度選單                                                |
+-----------------------------------------------------------------------+
| ![](media/image4.jpeg){width="3.8027318460192476in" height="2.25in"}  |
+-----------------------------------------------------------------------+
| 圖 4玩家一進行擺放階段                                                |
+-----------------------------------------------------------------------+
| ![](media/image5.jpeg){width="3.8046073928258966in" height="2.25in"}  |
+-----------------------------------------------------------------------+
| 圖 5玩家一完成擺放階段                                                |
+-----------------------------------------------------------------------+
| ![](media/image6.jpeg){width="3.821963035870516in" height="2.25in"}   |
+-----------------------------------------------------------------------+
| 圖 6雙人模式下玩家二完成擺放階段                                      |
+-----------------------------------------------------------------------+
| ![](media/image7.jpeg){width="3.8046073928258966in" height="2.25in"}  |
+-----------------------------------------------------------------------+
| 圖 7回合進行階段                                                      |
|                                                                       |
| （其中，此圖右棋盤格呈現亮棕色，為提示輪到玩家ㄧ）                    |
+-----------------------------------------------------------------------+
| ![](media/image8.jpeg){width="3.8046073928258966in" height="2.25in"}  |
+-----------------------------------------------------------------------+
| 圖 8回合進行階段                                                      |
|                                                                       |
| （其中，此圖左棋盤格呈現亮棕色，為提示輪到電腦/玩家二）               |
+-----------------------------------------------------------------------+
| ![](media/image9.jpeg){width="3.8046073928258966in" height="2.25in"}  |
+-----------------------------------------------------------------------+
| 圖 9 遊戲進行直到進入遊戲結束階段                                     |
+-----------------------------------------------------------------------+
| ![](media/image10.jpeg){width="3.8027318460192476in" height="2.25in"} |
+-----------------------------------------------------------------------+
| 圖 10 遊戲結束，可以選擇重玩或者離開遊戲。                            |
|                                                                       |
| （重玩即回到遊戲主選單**）**                                          |
+-----------------------------------------------------------------------+
| ![](media/image11.jpeg){width="3.8114818460192477in" height="2.25in"} |
+-----------------------------------------------------------------------+
| 圖 11 作弊模式下顯示所有船隻                                          |
+-----------------------------------------------------------------------+

3.   []{#_Toc137443824 .anchor}遊戲音效

表 3 陳列在遊戲中的音效資源：

  ----------------------------------------------------------------------------
  音效類別                                          音效檔案
  -------------------------- ---------------------- --------------------------
  遊戲主題音樂（背景音樂）                          "Theme.wav"

  擊中音效 (玩家)                                   "Hit_Marker.wav"

  擊中音效 (電腦)                                   "Error.wav"

  按鈕點擊音效                                      "Click.wav"

  未命中音效 1                                      "Missed1.wav"

  未命中音效 2                                      "Missed2.wav"

  未命中音效 3                                      "Missed3.wav"

  未命中音效 4                                      "Missed4.wav"

  單人模式下玩家一獲勝       其他難度               "Defeat_NotDS.wav"

                             極限難度               "Defeat_Dark_Soul.wav"

  單人模式下電腦獲勝                                "Defeated.wav"

  作弊模式啟動音效                                  "CheatModeActivated.wav"
  ----------------------------------------------------------------------------

4.  []{#_Toc137324705 .anchor}程式設計

    1.  []{#_Toc137324706 .anchor}程式架構

![](media/image12.jpeg){width="5.948052274715661in"
height="2.7470713035870515in"}

圖 12 遊戲 Class Diagram

2.  []{#_Toc137324707 .anchor}2程式類別

程式類別:將你自己寫的所有 class 列表，說明用途，並標示各個 class 標頭檔

(.h)及原始碼(.cpp)的行數。

表 4 陳列在遊戲中的程式類別名稱以及對應說明：

+--------------+---------+-------+-------+---------------------------+
| 繼承自       | 類      | 標    | 原    | 說明                      |
|              | 別名稱  | 頭檔  | 始碼  |                           |
|              |         | 行數  | 行數  |                           |
+==============+=========+=======+=======+===========================+
| C            | B       | 16    | 45    | 棋盤上每個格子的基礎類    |
| MovingBitmap | aseGrid |       |       | 別，具有以下屬性與方法：  |
|              |         |       |       |                           |
|              |         |       |       | 屬性：                    |
+--------------+---------+-------+-------+---------------------------+
|              |         |       |       |                           |
+--------------+---------+-------+-------+---------------------------+
|              |         |       |       |                           |
+--------------+---------+-------+-------+---------------------------+

5.  []{#_Toc137324708 .anchor}程式技術

關卡難度使用到之各種資料結構及演算方式：

1.  資料結構：

```{=html}
<!-- -->
```
A.  std::unordered_set\<CPoint\>
    ：無序集合資料結構，用於儲存電腦遇到的敵艦座標，檢查是否已經射中目標。為常數時間複雜度，$O(1)$，新增和搜尋。

B.  std::stack\<CPoint\>
    ：堆疊資料結構，用於執行深度優先搜尋（DFS）時以搜尋擊船位置（即攻擊敵方戰艦之策略）。

C.  std::deque\<CPoint\>
    ：雙端佇列資料結構，用於儲存敵方艦艇的座標，以提供在\"darkSoulModeFire\"（我們的魔王關卡）的模式下的電腦方作弊功能。

> （以上，CPoint表示二維座標中的一個點。）

2\. 演算法：

D.  Noob關卡（對應：新手方可嘗試）：函式 infiniteMonkeyModeFire()
    ，此僅重複用 randomlyPickCoordinate()
    ，直到找到一個未攻擊過的座標（即不在 \_map
    無序集合中），然後將該座標添加到集合中並丟回，亦即，電腦控制的敵方僅亂猜下棋位置。

E.  Hard關卡（對應：了解規則的玩家方可嘗試）：函式 normalModeFire()
    ，檢查DFS堆疊（ \_dfsStack ）是否為空。

    1.  如果為空，它使用 randomlyPickCoordinate()
        選擇一個隨機座標並將其設置為上一個座標。

    2.  如果堆疊不為空，它從堆疊中取出頂部座標，將其設置為上一個座標並從堆疊中刪除。然後回傳該座標。

F.  Expert關卡（對應：了解相較深入複雜的棋譜擺放的專家方可嘗試）：函式
    hardModeFire() ，檢查DFS堆疊 \_dfsStack
    是否為空。如果為空，它使用一種算法找到新的攻擊座標：

    1.  如果 \_map 無序集合為空，它使用 randomlyPickCoordinate()
        選擇一個隨機座標。

    2.  如果 \_map
        不為空，它從集合中選擇一個座標，然後根據特定的策略找到該座標的相鄰座標，這些座標必須是未攻擊過的且在（0,
        0）到（10, 10），（有向的）範圍內，同樣回傳找到的座標。\
        而，另外 \_dfsStack 實作是根據getFeedback(const bool& res)

> 函式攻擊結果來更新

G.  Master關卡（對應：想瞭解並實測今天自己的運氣是否爆棚的人，且懂遊戲規則的玩家方可嘗試。）：函式
    darkSoulModeFire() 首先檢查 \_cheatCount 是否小於0，並且
    \_cheatSheet 不為空。

    1.  其中，\_cheatCount
        是一個計數器，表示還有多少次可以使用作弊的機會。當
        **\_**cheatCount 減減到小於 0
        時，代表電腦已經用完了所有的作弊次數。

    2.  其中，**\_**cheatSheet 是一個儲存敵艦座標的雙向隊列。當
        **\_**cheatSheet 不為空時，代表電腦已經獲得了敵艦的座標資訊。\
        而，另外 **\_**cheatSheet實作：gatherEnemyShipCoordinates(const
        std::deque\<CPoint\>& pt) -- --

-   此函式接收一個 CPoint 物件的雙向隊列，表示敵艦的座標。

-   它將該雙向隊列賦值給 \_cheatSheet 成員變數。

-   這表示敵艦的座標已經被記錄在 \_cheatSheet 中。

    i.  如果滿足以上兩個條件，它從 \_cheatSheet
        的前端取出一個座標，將其設置為上一個座標並回傳得到的值。（亦即，電腦方使用
        **\_**cheatSheet 中的座標進行攻擊，而不是依靠其他的演算策略。）

    ii. 否則，用 hardModeFire() 函式。

    ```{=html}
    <!-- -->
    ```
    1.  []{#_Toc137324709 .anchor}四、結語

    2.  []{#_Toc137324710 .anchor}[1.
        問題及解決方法（待詢問討論）]{.mark}

整學期所碰到的問題及解決方法。

3.  []{#_Toc137324711 .anchor}[2. 時間表（填寫時間）]{.mark}

表 5 說明(1 至 17 週)撰寫遊戲的時數、工作項目與整學期的總時數。

+-------+----------------+----------------+---------------------------+
| 週次  | 張庭瑋         | 李子儀         | 說明                      |
+=======+================+================+===========================+
| 1     |                | 3              | -   建立船艦物件（包      |
|       |                |                | 含：功能及原始形象。i.e.  |
|       |                |                |     add rotate function,  |
|       |                |                |     ships\' image）       |
|       |                |                |                           |
|       |                |                | -   Add myIsOverlap()     |
|       |                |                |     以修 CMovingBitmap    |
|       |                |                |     建置錯誤              |
+-------+----------------+----------------+---------------------------+
| 2     |                | 3              | -   原始的棋盤建          |
|       |                |                | 置（敵方棋盤先用複製的）  |
|       |                |                |                           |
|       |                |                | -   遊戲現在在一名        |
|       |                |                | 玩家的船隻全部沉沒時結束  |
|       |                |                |                           |
|       |                |                | -                         |
|       |                |                |    船隻被擊中有不同的標記 |
|       |                |                |                           |
|       |                |                | -   開始清理程式          |
|       |                |                |                           |
|       |                |                | -   將 class 和functions  |
|       |                |                |     分到檔案中            |
+-------+----------------+----------------+---------------------------+
| 3     |                | 11             | -   進行清理程式          |
|       |                |                |                           |
|       |                |                | -   建立phaseManager      |
|       |                |                |                           |
|       |                |                | -                         |
|       |                |                |  將一些初始化進程移動到類 |
|       |                |                |     phaseManager_XX       |
|       |                |                |                           |
|       |                |                | -   更新框架到v1.1.3      |
+-------+----------------+----------------+---------------------------+
| 4     |                | 19             | -   創建新的              |
|       |                |                | 遊戲棋譜給電腦方或玩家二  |
+-------+----------------+----------------+---------------------------+
| 5     |                | 3              | -   繼續進行清理程式      |
|       |                |                |                           |
|       |                |                | -   玩家現在進行遊戲      |
|       |                |                |                           |
|       |                |                | -   可以在攻擊後連續猜    |
|       |                |                |                           |
|       |                |                | -   將所有switch-case     |
|       |                |                |     替換為if-elseif。     |
|       |                |                |                           |
|       |                |                | -   將所有初              |
|       |                |                | 始化工作移至phaseManager  |
|       |                |                |                           |
|       |                |                | -   隨機生成棋盤。        |
|       |                |                |                           |
|       |                |                | -   Replace C-style       |
|       |                |                |     pointers to smart     |
|       |                |                |     pointers.             |
+-------+----------------+----------------+---------------------------+
| 6     |                | 10             | -   Replace pointers      |
|       |                |                |     involving allocating  |
|       |                |                |     new memory with smart |
|       |                |                |     pointers              |
|       |                |                |                           |
|       |                |                | -   猜測船隻位置功能      |
|       |                |                |                           |
|       |                |                | -   關卡一（              |
|       |                |                | noob）關卡二（hard）建立  |
|       |                |                |                           |
|       |                |                | -   將 phaseManagers      |
|       |                |                |     重命名為              |
|       |                |                |     PhaseInitializers     |
|       |                |                |     並合併 p1Turn 和      |
|       |                |                |     p2Turn                |
+-------+----------------+----------------+---------------------------+
| 7     |                | 20             | -   更有策                |
|       |                |                | 略的關卡三（expert）建立  |
|       |                |                |                           |
|       |                |                | -   更外                  |
|       |                |                | 掛的關卡四（master）建立  |
|       |                |                |                           |
|       |                |                | -   雙人模式初始模式建立  |
|       |                |                |                           |
|       |                |                | -                         |
|       |                |                |    雙人模式修正使可以開始 |
+-------+----------------+----------------+---------------------------+

+-------+----------------+----------------+---------------------------+
| 8     |                | 3              | -   添加gameBoard的背景   |
|       |                |                |                           |
|       |                |                | -   為按鈕添加相應的功能  |
|       |                |                |                           |
|       |                |                | -   更新 README.md        |
+=======+================+================+===========================+
| 9     |                | 3              | -   背景音樂製作中        |
|       |                |                |                           |
|       |                |                | -   新背景UI製作中        |
+-------+----------------+----------------+---------------------------+
| 10    |                | 3              | -   背景音樂仍在製作中    |
|       |                |                |                           |
|       |                |                | -   新背景UI仍在製作中    |
+-------+----------------+----------------+---------------------------+
| 11    |                | 14             | -   背景音樂完成          |
|       |                |                |                           |
|       |                |                | -   新背景UI仍在製作中    |
+-------+----------------+----------------+---------------------------+
| 12    |                | 34             | -   新背景UI完成          |
|       |                |                |                           |
|       |                |                | -   多人模式完成          |
|       |                |                |                           |
|       |                |                | -                         |
|       |                |                |    從選單中刪除"選項"按鈕 |
|       |                |                |                           |
|       |                |                | -   更新UI包括船隻外觀    |
+-------+----------------+----------------+---------------------------+
| 13    |                | 3              | -   重構資源路徑          |
|       |                |                |                           |
|       |                |                | -   重構資源路徑          |
|       |                |                |                           |
|       |                |                | -   修復 ships 的         |
|       |                |                |     basePath 路徑錯誤     |
+-------+----------------+----------------+---------------------------+
| 14    |                | 3              | -   開啟作弊模式          |
|       |                |                |                           |
|       |                |                | -   解決綠屏不透明問題    |
|       |                |                |                           |
|       |                |                | 修                        |
|       |                |                | 復了一個導致背景音樂在某  |
|       |                |                | 種程度上無法停止的錯誤。  |
|       |                |                |                           |
|       |                |                | -   修復                  |
|       |                |                | 導致背景音樂無法播放的bug |
+-------+----------------+----------------+---------------------------+
| 15    |                | 10             | -   Add Help/About        |
|       |                |                |                           |
|       |                |                | -   期末報告製作          |
+-------+----------------+----------------+---------------------------+
| 16    |                | 20             | -   期末報告製作          |
+-------+----------------+----------------+---------------------------+
| 17    |                |                | -                         |
+-------+----------------+----------------+---------------------------+

1.  []{#_Toc137324712 .anchor}3. 貢獻比例

表 6貢獻比例表

  -----------------------------------------------------------------------
  張庭瑋                              李子儀
  ----------------------------------- -----------------------------------
  60%                                 40%

  -----------------------------------------------------------------------

2.  []{#_Toc137324713 .anchor}自我檢核表

表 7自我檢核表

  -------------------------------------------------------------------------------------------
       項目                                           是否完成            說明為何不能完成
  ---- ---------------------------------------------- ------------------- -------------------
  1    解決 Memory Leak 的問題                                            

  2    自訂遊戲 Icon                                                      

  3    About 畫面                                                         

  4    遊戲中說明如何操作                                                 

  5    發佈(Release)版本                                                  

  6    承上項，該版本可以正常運作                                         

  7    報告字型、點數、對齊、行距、頁碼等格式正確。                       
  -------------------------------------------------------------------------------------------

3.  []{#_Toc137324714 .anchor}收穫

```{=html}
<!-- -->
```
1.  學會設計和實現遊戲的規則和算法：海戰棋遊戲咖發，其中不僅是隨機的運氣猜測，對於人類或機器該如何思考，好好的下棋，其中是很具有規則和策略的。在流程規則上：我們需要思考如何實現遊戲的擺放階段、回合進行階段和遊戲結束階段等不同的遊戲狀態和轉換。在遊戲策略上：我們需要更近一步思考回合進行階段時，該如何突破，在更短的時間內通過或贏得遊戲。通過對遊戲規則和策略算法的設計和實現，我們學會了思考演算法和設計，並加深了對物件導向觀念的理解。

2.  瞭解物件導向程式設計的優勢：將遊戲元素抽象成物件，可以更好地組織和管理程式碼，提高代碼的可讀性和可維護性。同時，使用繼承和多型等特性可以實現代碼的重用和靈活性，使我們能夠更容易地擴展和修改遊戲的功能。

3.  團隊合作和溝通能力的提升：在專案中，我們需要與團隊成員合作，協調工作進度，討論設計和實現的細節，並解決可能出現的問題。這個過程提高了我們的團隊合作和溝通能力，並學會了如何有效地與團隊合作，使專案順利進行。

    1.  []{#_Toc137324715 .anchor}心得或感想

在開發這次下學期實習課的專案---海戰棋遊戲，讓我們更加深入的應用了基礎程式設計和上學期物件導向程式設計等課程的演算概念和開發技術。這個專題是基於物件導向的遊戲，課程原本提供就遊戲框架，因為這使我們更容易踏入專案並知道如何著手，遊戲框架提供的架構，包括遊戲邏輯、圖形界面和用以及遊戲真的可以提供使用者I/O體驗的部分涉及到CMovingBitmap的部分方面的實現，這些都更具體地讓我們知道並感受到程式開發的內容及意義，綜合以上條列的收穫點，物件導向確實讓我們更加熟悉了大型程式開發使用物件導向的意義，並且基於應用物件導向的概念，實踐將遊戲元素轉化為物件，並使用封裝、繼承和多型等概念來組織和設計整個遊戲。

2.  []{#_Toc137324716 .anchor}對於本課程的建議、想說的話:如果有的話

謝謝老師、助教。
