國立臺北科技大學

2023 Spring 資工系物件導向程式實習

期末報告

海戰棋

![](media/image1.jpeg){width="5.768055555555556in"
height="3.4069444444444446in"}

第九組：

# 目錄 {#目錄 .TOC-Heading}

[壹、 簡介 [3](#_Toc137324698)](#_Toc137324698)

[一、 動機 [3](#_Toc137443817)](#_Toc137443817)

[二、 分工 [4](#_Toc137324700)](#_Toc137324700)

[貳、 遊戲介紹 [5](#_Toc137324701)](#_Toc137324701)

[一、 遊戲說明 [5](#_Toc137324702)](#_Toc137324702)

[二、 遊戲圖形 [7](#_Toc137443823)](#_Toc137443823)

[三、 遊戲音效 [12](#_Toc137443824)](#_Toc137443824)

[四、 三、程式設計 [13](#_Toc137324705)](#_Toc137324705)

[五、 1. 程式架構 [13](#_Toc137324706)](#_Toc137324706)

[六、 2. 程式類別 [13](#_Toc137324707)](#_Toc137324707)

[七、 程式技術 [14](#_Toc137324708)](#_Toc137324708)

[八、 四、結語 [16](#_Toc137324709)](#_Toc137324709)

[九、 [1. 問題及解決方法（待詢問討論）]{.mark}
[16](#_Toc137324710)](#_Toc137324710)

[十、 [2. 時間表（填寫時間）]{.mark}
[16](#_Toc137324711)](#_Toc137324711)

[十一、 3. 貢獻比例 [20](#_Toc137324712)](#_Toc137324712)

[十二、 自我檢核表 [20](#_Toc137324713)](#_Toc137324713)

[十三、 收穫 [20](#_Toc137324714)](#_Toc137324714)

[十四、 心得或感想 [21](#_Toc137324715)](#_Toc137324715)

[十五、 對於本課程的建議、想說的話:如果有的話
[22](#_Toc137324716)](#_Toc137324716)

**\
**

**\
**

1.  []{#_Toc137324698 .anchor}簡介

    1.  　[]{#_Toc137443817 .anchor}動機

> 本專題選擇開發海戰棋遊戲作為物件導向程式設計的主題，旨在探索並應用基礎程式設計與物件導向程式設計，帶給我們的演算邏輯及物件概念和技術。海戰棋遊戲，不單是一款僅頻運氣隨機就能取勝的遊戲，更是一款具有豐富的規則性和策略性的遊戲，玩家需思考佈局、推測對手的船艦位置和分析對手的行動模式等，這將提供思考演算法和設計，不同的遊戲關卡難度，也將會有對應不同的應對規則。遊戲的規則和算法將進一步，促使深入應用與理解物件導向觀念，透過良好的物件導向程式設計架構的建立，將遊戲與算法元素轉化為物件，並利用封裝、繼承和多形等概念來組織創建整體遊戲。

2.  []{#_Toc137324700 .anchor}分工

    1.  張庭瑋

        I.  客製化類別與函式

        II. 通用遊戲架構

            i.  棋盤擺放與隨機配置

            ii. 回合機制

            iii. 音效

            iv. 作弊模式

        III. 單人模式

        IV. 報告

    2.  李子儀

        I.  雙人模式

        II. 棋譜衍伸類別建置

        III. UI

        IV. 報告

```{=html}
<!-- -->
```
2.  []{#_Toc137324701 .anchor}遊戲介紹

    1.  []{#_Toc137324702 .anchor}遊戲說明

> 開啟遊戲時會進入遊戲首頁（圖 1），在此頁面點擊左鍵即可進入主選單。
>
> 主選單（）提供玩家兩種模式可供選擇，分別是單人模式和雙人模式。單人模式共有四種難度（圖
> 3）：菜鳥、困難、專家與大師。在選擇完難度後進入擺放階段。
>
> 在擺放階段（圖
> 4、）中，玩家可以根據個人策略進行手動擺放船艦，也可以選擇自動擺放功能，由系統自動為其擺放船艦。不論是手動還是自動擺放，玩家在擺放完成後仍有機會進行微調修改，以確保自己的船艦佈局最為理想。
>
> 另一方面，如果玩家選擇雙人模式，則玩家一和玩家二將輪流進行擺放階段（、圖
> 5、圖 6）。
>
> 當雙方完成擺放後，遊戲進入回合進行階段（、圖
> 8）。在每輪遊戲中，玩家一將先行，從棋盤上選擇一格進行猜測。玩家可以選擇不同的位置進行猜測，以找出敵方的戰艦位置。
>
> 若玩家一猜中了敵方的戰艦，他將繼續進行猜測，直到未猜中為止。然後，輪到電腦控制的敵方（如果是單人模式）或玩家二進行猜測，依此類推。
>
> 在每個回合結束後，回合進行權將再次回到玩家一手中，並依此輪流進行，直到其中一方擊沉了對方的所有船艦（圖
> 9），此時進入遊戲的結束階段。
>
> 在結束階段（圖 10）中有兩個按鈕。分別提供回到主選單與離開遊戲的功能。
>
> 此外，遊戲配有作弊模式（圖
> 10）。使用作弊碼「上上下下左右左右ＢＡ」以開啟作弊模式。當作弊模式啟用時會切換背景音樂，在回合階段中顯示雙方所有船隻。

2.  []{#_Toc137443823 .anchor}遊戲圖形

表 1 遊戲圖形與對應介紹表

+-----------------------------------------------------------------------+
| ![](media/image1.jpeg){width="3.8027318460192476in" height="2.25in"}  |
+=======================================================================+
| 圖 1遊戲首頁頁面                                                      |
+-----------------------------------------------------------------------+
| ![](media/image2.jpeg){width="3.8027318460192476in" height="2.25in"}  |
+-----------------------------------------------------------------------+
| 圖 2遊戲主選單                                                        |
+-----------------------------------------------------------------------+
| ![](media/image3.jpeg){width="3.821963035870516in" height="2.25in"}   |
+-----------------------------------------------------------------------+
| 圖 3單人模式困難度選單                                                |
+-----------------------------------------------------------------------+
| ![](media/image4.jpeg){width="3.8027318460192476in" height="2.25in"}  |
+-----------------------------------------------------------------------+
| 圖 4玩家一進行擺放階段                                                |
+-----------------------------------------------------------------------+
| ![](media/image5.jpeg){width="3.8046073928258966in" height="2.25in"}  |
+-----------------------------------------------------------------------+
| 圖 5玩家一完成擺放階段                                                |
+-----------------------------------------------------------------------+
| ![](media/image6.jpeg){width="3.821963035870516in" height="2.25in"}   |
+-----------------------------------------------------------------------+
| 圖 6雙人模式下玩家二完成擺放階段                                      |
+-----------------------------------------------------------------------+
| ![](media/image7.jpeg){width="3.8046073928258966in" height="2.25in"}  |
+-----------------------------------------------------------------------+
| 圖 7回合進行階段                                                      |
|                                                                       |
| （其中，此圖右棋盤格呈現亮棕色，為提示輪到玩家ㄧ）                    |
+-----------------------------------------------------------------------+
| ![](media/image8.jpeg){width="3.8046073928258966in" height="2.25in"}  |
+-----------------------------------------------------------------------+
| 圖 8回合進行階段                                                      |
|                                                                       |
| （其中，此圖左棋盤格呈現亮棕色，為提示輪到電腦/玩家二）               |
+-----------------------------------------------------------------------+
| ![](media/image9.jpeg){width="3.8046073928258966in" height="2.25in"}  |
+-----------------------------------------------------------------------+
| 圖 9 遊戲進行直到進入遊戲結束階段                                     |
+-----------------------------------------------------------------------+
| ![](media/image10.jpeg){width="3.8027318460192476in" height="2.25in"} |
+-----------------------------------------------------------------------+
| 圖 10 遊戲結束，可以選擇重玩或者離開遊戲。                            |
|                                                                       |
| （重玩即回到遊戲主選單**）**                                          |
+-----------------------------------------------------------------------+
| ![](media/image11.jpeg){width="3.8114818460192477in" height="2.25in"} |
+-----------------------------------------------------------------------+
| 圖 11 作弊模式下顯示所有船隻                                          |
+-----------------------------------------------------------------------+

3.   []{#_Toc137443824 .anchor}遊戲音效

表 3 陳列在遊戲中的音效資源：

  ----------------------------------------------------------------------------
  音效類別                                          音效檔案
  -------------------------- ---------------------- --------------------------
  遊戲主題音樂（背景音樂）                          "Theme.wav"

  擊中音效 (玩家)                                   "Hit_Marker.wav"

  擊中音效 (電腦)                                   "Error.wav"

  按鈕點擊音效                                      "Click.wav"

  未命中音效 1                                      "Missed1.wav"

  未命中音效 2                                      "Missed2.wav"

  未命中音效 3                                      "Missed3.wav"

  未命中音效 4                                      "Missed4.wav"

  單人模式下玩家一獲勝       其他難度               "Defeat_NotDS.wav"

                             大師難度               "Defeat_Dark_Soul.wav"

  單人模式下電腦獲勝                                "Defeated.wav"

  作弊模式啟動音效                                  "CheatModeActivated.wav"
  ----------------------------------------------------------------------------

3.  []{#_Toc137324705 .anchor}程式設計

    1.  []{#_Toc137324706 .anchor}程式架構

> 遊戲主要在mygame.h與mygame_run.cpp中運行並配合其他類別與函式運行。
>
> 初始化階段由於含有大量路徑使得init()變得十分冗長，故使用PhaseInitializer系列物件以減少mygame_run中的行數。
>
> 在擺放與回合進行階段主要使用GameBoard類別的物件管理BaseGrid與其子類別物件，並使用tinyUtils中自定義的各式函式針對不屬於類別應有的功能(例如複製及生成棋盤等)進行操作。

+-----------------------------------------------------------------------+
| []{#_Toc137324707                                                     |
| .anchor}![](media/image12.jpeg){width="5.948052274715661in"           |
| height="2.7470713035870515in"}                                        |
|                                                                       |
| 圖 12 遊戲 Class Diagram                                              |
+=======================================================================+
+-----------------------------------------------------------------------+

2.  程式類別

表 4 陳列在遊戲中的程式類別名稱以及對應說明：

  --------------------------------------------------------------------------------------------------------------------------------------------------
  繼承自                  類別名稱                     標頭檔行數   原始碼行數   說明
  ----------------------- ---------------------------- ------------ ------------ -------------------------------------------------------------------
  CMovingBitmap           BaseGrid                     18           45           棋盤上每個格子的基礎類別

  BaseGrid                EmptyGrid                                              空白格子

  BaseGrid                Ship                         28           90           實作船隻類別（包含船隻血量、方向等屬性）

  CMovingBitmp            myBtn                        15           31           實作按鈕類別

  無                      GameBoard                    51           250          實作管理、顯示棋盤上所有格子的類別

  無                      Robot                        51           150          四種難度的機器人以模擬單人模式下的玩家二

  無                      PhaseInitializer_base        77           91           初始化工具的基礎類別

  PhaseInitializer_base   PhaseInitializer_global                                各遊戲階段的初始化工具，負責初始化各個CMovingBitmap的資源與預設幀

  PhaseInitializer_base   PhaseInitializer_menu                                  

  PhaseInitializer_base   PhaseInitializer_placement                             

  PhaseInitializer_base   PhaseInitializer_ending                                

  PhaseInitializer_base   PhaseInitializer_cheatMode                             
  --------------------------------------------------------------------------------------------------------------------------------------------------

3.  []{#_Toc137324708 .anchor}程式技術[]{#_Toc137324709 .anchor}

    1.  **不同難度的機器人**

> 單人模式下的機器人一共有四種難度。在不重複(Robot類別中有一個set紀錄已經下過的位置，每當試圖下在重複位置時會重新依照各難度的方式重新選取一格)分別使用不同的邏輯進行下棋：

I.  新手模式：簡單模式下的機器人採取「[猴子打字機](https://en.wikipedia.org/wiki/Infinite_monkey_theorem)」\
    策略，每一次的出手都是隨機選取。

II. 困難模式：基於新手模式的邏輯，但在成功擊中船隻後會嘗試往上、下、左與右進行猜測。

III. 專家模式：參考[此](https://www.gamesver.com/how-to-win-at-battleship-tips-tricks-strategies-boost-your-win-rate/)網頁的教學，平時以西洋棋盤狀猜測，在擊中船隻時與困難模式一樣，會往四周猜測。

IV. 大師（作弊）模式：此模式下的機器人會在內部的_cheatCout歸零前照著專家模式的邏輯進行遊戲，並在歸零後讀取在遊戲開始時取得的玩家船隻座標一一攻擊。

```{=html}
<!-- -->
```
2.  **空間換取時間**

> 考量到掉幀對於遊玩體驗的破壞，我們的最佳化策略大略上為使用空間換取時間。我們使用了許多額外變數紀錄船隻位置、前次攻擊結果等資訊，避免O(n\^2)的掃瞄棋盤發生。
>
> 例如在實作GameBoard::dropShip()時，棋盤需要檢查是否有足夠的格子能在不超出邊界或是與其他船隻重疊。利用BaseGrid底下的_shipID屬性。其預設值是-1，並在有船隻於此進行互動時做對應的更動。藉此，我們可以在O(船隻大小)的時間下而非遍歷整個棋盤的情況下檢查。

3.  **智慧指標**

> 使用現代C++的智慧指標。利用解構式不論是抵達生命週期盡頭或是被例外丟出都會執行的特性解決傳統指標容易產生記憶體洩漏的問題進而增加安全性。

4.  結語

    1.  []{#_Toc137324710 .anchor}問題及解決方法

> []{#_Toc137324711
> .anchor}這學期的實作由於我們挑選的題目相較其他組沒有那麼複雜，遇到的問題並沒有很多。底下稍微列出幾個困擾較久的：
>
> 第一個是環境建置的問題。由於對於Visual
> Studio的操作、介面與他的啟動時間十分感冒，決定還是使用Jetbrains
> Rider配上MSBuild作為主要開發環境。然而在期中發Release前想要把編譯目標從著重快速編譯的Debug模式改為注重執行效能的Release版本卻遇到了.vcproj對於預編譯標頭檔的設定問題，幸虧在一番搜尋後也成功把執行檔縮小。
>
> 第二個是當初在做隨機棋盤時原本是假的隨機，建好數個棋盤再透過亂數產生選一個使用。後來經過一番討論後才變成現在的找空位放置。

2.  [時間表（填寫時間）]{.mark}

+-------+----------------+----------------+---------------------------+
| 週次  | 張庭瑋         | 李子儀         | 說明                      |
+=======+================+================+===========================+
| 1     |                | 3              | -   建立船艦物件（包      |
|       |                |                | 含：功能及原始形象。i.e.  |
|       |                |                |     add rotate function,  |
|       |                |                |     ships\' image）       |
|       |                |                |                           |
|       |                |                | -   Add myIsOverlap()     |
|       |                |                |     以修 CMovingBitmap    |
|       |                |                |     建置錯誤              |
+-------+----------------+----------------+---------------------------+
| 2     |                | 3              | -   原始的棋盤建          |
|       |                |                | 置（敵方棋盤先用複製的）  |
|       |                |                |                           |
|       |                |                | -   遊戲現在在一名        |
|       |                |                | 玩家的船隻全部沉沒時結束  |
|       |                |                |                           |
|       |                |                | -                         |
|       |                |                |    船隻被擊中有不同的標記 |
|       |                |                |                           |
|       |                |                | -   開始清理程式          |
|       |                |                |                           |
|       |                |                | -   將 class 和functions  |
|       |                |                |     分到檔案中            |
+-------+----------------+----------------+---------------------------+
| 3     |                | 11             | -   進行清理程式          |
|       |                |                |                           |
|       |                |                | -   建立phaseManager      |
|       |                |                |                           |
|       |                |                | -                         |
|       |                |                |  將一些初始化進程移動到類 |
|       |                |                |     phaseManager_XX       |
|       |                |                |                           |
|       |                |                | -   更新框架到v1.1.3      |
+-------+----------------+----------------+---------------------------+
| 4     |                | 19             | -   創建新的              |
|       |                |                | 遊戲棋譜給電腦方或玩家二  |
+-------+----------------+----------------+---------------------------+
| 5     |                | 3              | -   繼續進行清理程式      |
|       |                |                |                           |
|       |                |                | -   玩家現在進行遊戲      |
|       |                |                |                           |
|       |                |                | -   可以在攻擊後連續猜    |
|       |                |                |                           |
|       |                |                | -   將所有switch-case     |
|       |                |                |     替換為if-elseif。     |
|       |                |                |                           |
|       |                |                | -   將所有初              |
|       |                |                | 始化工作移至phaseManager  |
|       |                |                |                           |
|       |                |                | -   隨機生成棋盤。        |
|       |                |                |                           |
|       |                |                | -   Replace C-style       |
|       |                |                |     pointers to smart     |
|       |                |                |     pointers.             |
+-------+----------------+----------------+---------------------------+
| 6     |                | 10             | -   Replace pointers      |
|       |                |                |     involving allocating  |
|       |                |                |     new memory with smart |
|       |                |                |     pointers              |
|       |                |                |                           |
|       |                |                | -   猜測船隻位置功能      |
|       |                |                |                           |
|       |                |                | -   關卡一（              |
|       |                |                | noob）關卡二（hard）建立  |
|       |                |                |                           |
|       |                |                | -   將 phaseManagers      |
|       |                |                |     重命名為              |
|       |                |                |     PhaseInitializers     |
|       |                |                |     並合併 p1Turn 和      |
|       |                |                |     p2Turn                |
+-------+----------------+----------------+---------------------------+
| 7     |                | 20             | -   更有策                |
|       |                |                | 略的關卡三（expert）建立  |
|       |                |                |                           |
|       |                |                | -   更外                  |
|       |                |                | 掛的關卡四（master）建立  |
|       |                |                |                           |
|       |                |                | -   雙人模式初始模式建立  |
|       |                |                |                           |
|       |                |                | -                         |
|       |                |                |    雙人模式修正使可以開始 |
+-------+----------------+----------------+---------------------------+

+-------+----------------+----------------+---------------------------+
| 8     |                | 3              | -   添加gameBoard的背景   |
|       |                |                |                           |
|       |                |                | -   為按鈕添加相應的功能  |
|       |                |                |                           |
|       |                |                | -   更新 README.md        |
+=======+================+================+===========================+
| 9     |                | 3              | -   背景音樂製作中        |
|       |                |                |                           |
|       |                |                | -   新背景UI製作中        |
+-------+----------------+----------------+---------------------------+
| 10    |                | 3              | -   背景音樂仍在製作中    |
|       |                |                |                           |
|       |                |                | -   新背景UI仍在製作中    |
+-------+----------------+----------------+---------------------------+
| 11    |                | 14             | -   背景音樂完成          |
|       |                |                |                           |
|       |                |                | -   新背景UI仍在製作中    |
+-------+----------------+----------------+---------------------------+
| 12    |                | 34             | -   新背景UI完成          |
|       |                |                |                           |
|       |                |                | -   多人模式完成          |
|       |                |                |                           |
|       |                |                | -                         |
|       |                |                |    從選單中刪除"選項"按鈕 |
|       |                |                |                           |
|       |                |                | -   更新UI包括船隻外觀    |
+-------+----------------+----------------+---------------------------+
| 13    |                | 3              | -   重構資源路徑          |
|       |                |                |                           |
|       |                |                | -   重構資源路徑          |
|       |                |                |                           |
|       |                |                | -   修復 ships 的         |
|       |                |                |     basePath 路徑錯誤     |
+-------+----------------+----------------+---------------------------+
| 14    |                | 3              | -   開啟作弊模式          |
|       |                |                |                           |
|       |                |                | -   解決綠屏不透明問題    |
|       |                |                |                           |
|       |                |                | 修                        |
|       |                |                | 復了一個導致背景音樂在某  |
|       |                |                | 種程度上無法停止的錯誤。  |
|       |                |                |                           |
|       |                |                | -   修復                  |
|       |                |                | 導致背景音樂無法播放的bug |
+-------+----------------+----------------+---------------------------+
| 15    |                | 10             | -   Add Help/About        |
|       |                |                |                           |
|       |                |                | -   期末報告製作          |
+-------+----------------+----------------+---------------------------+
| 16    |                | 20             | -   期末報告製作          |
+-------+----------------+----------------+---------------------------+
| 17    |                |                | -                         |
+-------+----------------+----------------+---------------------------+

1.  []{#_Toc137324712 .anchor}3. 貢獻比例

表 6貢獻比例表

  -----------------------------------------------------------------------
  張庭瑋                              李子儀
  ----------------------------------- -----------------------------------
  60%                                 40%

  -----------------------------------------------------------------------

2.  []{#_Toc137324713 .anchor}自我檢核表

表 7自我檢核表

  -------------------------------------------------------------------------------------------
       項目                                           是否完成            說明為何不能完成
  ---- ---------------------------------------------- ------------------- -------------------
  1    解決 Memory Leak 的問題                                            

  2    自訂遊戲 Icon                                                      

  3    About 畫面                                                         

  4    遊戲中說明如何操作                                                 

  5    發佈(Release)版本                                                  

  6    承上項，該版本可以正常運作                                         

  7    報告字型、點數、對齊、行距、頁碼等格式正確。                       
  -------------------------------------------------------------------------------------------

3.  []{#_Toc137324714 .anchor}收穫

```{=html}
<!-- -->
```
1.  學會設計和實現遊戲的規則和算法：海戰棋遊戲咖發，其中不僅是隨機的運氣猜測，對於人類或機器該如何思考，好好的下棋，其中是很具有規則和策略的。在流程規則上：我們需要思考如何實現遊戲的擺放階段、回合進行階段和遊戲結束階段等不同的遊戲狀態和轉換。在遊戲策略上：我們需要更近一步思考回合進行階段時，該如何突破，在更短的時間內通過或贏得遊戲。通過對遊戲規則和策略算法的設計和實現，我們學會了思考演算法和設計，並加深了對物件導向觀念的理解。

2.  瞭解物件導向程式設計的優勢：將遊戲元素抽象成物件，可以更好地組織和管理程式碼，提高代碼的可讀性和可維護性。同時，使用繼承和多型等特性可以實現代碼的重用和靈活性，使我們能夠更容易地擴展和修改遊戲的功能。

3.  團隊合作和溝通能力的提升：在專案中，我們需要與團隊成員合作，協調工作進度，討論設計和實現的細節，並解決可能出現的問題。這個過程提高了我們的團隊合作和溝通能力，並學會了如何有效地與團隊合作，使專案順利進行。

    1.  []{#_Toc137324715 .anchor}心得或感想

在開發這次下學期實習課的專案---海戰棋遊戲，讓我們更加深入的應用了基礎程式設計和上學期物件導向程式設計等課程的演算概念和開發技術。這個專題是基於物件導向的遊戲，課程原本提供就遊戲框架，因為這使我們更容易踏入專案並知道如何著手，遊戲框架提供的架構，包括遊戲邏輯、圖形界面和用以及遊戲真的可以提供使用者I/O體驗的部分涉及到CMovingBitmap的部分方面的實現，這些都更具體地讓我們知道並感受到程式開發的內容及意義，綜合以上條列的收穫點，物件導向確實讓我們更加熟悉了大型程式開發使用物件導向的意義，並且基於應用物件導向的概念，實踐將遊戲元素轉化為物件，並使用封裝、繼承和多型等概念來組織和設計整個遊戲。

2.  []{#_Toc137324716 .anchor}對於本課程的建議、想說的話:如果有的話

謝謝老師、助教。
